<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * Controller master data skpd
 */

class Rka extends CI_Controller {

	function __contruct()
	{	
		parent::__construct();

	}
    
function rka0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0','');
	}
function rka1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1','');
	}
function rka21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21','');
	}
function rka22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 22','rka22','');
	}
function rka221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221','');
	}
function rka0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd','');
	}
function rka1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd','');
	}
function rka21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd','');
	}
function rka31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31','');
	}
function rka32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32','');
	}
function dpa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0','');
	}
function dppa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0','');
	}
function dppa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd','');
	}
function dpa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1','');
	}
function dppa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1','');
	}
function dppa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd','');
	}
function dpa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21','');
	}
function dppa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21','');
	}
function dppa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd','');
	}
function dpa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22','');
	}
function dppa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22','');
	}
function dpa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 221','dpa221','');
	}
function dppa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221','');
	}
function dpa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0 PPKD','dpa0pkd','');
	}
function dpa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1 PPKD','dpa1pkd','');
	}
function dpa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21 PPKD','dpa21pkd','');
	}
function dpa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 31 PPKD','dpa31','');
	}
function dppa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31','');
	}
function dpa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 32 PPKD','dpa32','');
	}
function dppa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32','');
	}    
function perda_1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN I','perda_1','');
	}
 function perda_III()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN III','perda_III','');
	}
 function perkada_II()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_II','');
	}    
 function perkada_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah','');
	}   
 function perda_1_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda_1_ubah','');
	}

function perda_III_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah','');
	}  





	
function index($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)
	{
		$data['page_title'] = "CETAK $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->master_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->master_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
 
		$config['base_url']		= site_url("rka/".$list);
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	           
		//$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
         if(empty($lccari)){     
		$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit, $offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$data['sikap'] = 'list';
		$this->template->set('title', 'CETAK RKA');
		$this->template->load('template', "anggaran/rka/".$list, $data);
	}
    
   
    
    function  tanggal_format_indonesia($tgl){
        $tanggal  =  substr($tgl,8,2);
        $bulan  = $this-> getBulan(substr($tgl,5,2));
        $tahun  =  substr($tgl,0,4);
        return  $tanggal.' '.$bulan.' '.$tahun;

    }
 
    function  getBulan($bln){
        switch  ($bln){
        case  1:
        return  "Januari";
        break;
        case  2:
        return  "Februari";
        break;
        case  3:
        return  "Maret";
        break;
        case  4:
        return  "Maret";
        break;
        case  5:
        return  "Mei";
        break;
        case  6:
        return  "Juni";
        break;
        case  7:
        return  "Juli";
        break;
        case  8:
        return  "Agustus";
        break;
        case  9:
        return  "September";
        break;
        case  10:
        return  "Oktober";
        break;
        case  11:
        return  "November";
        break;
        case  12:
        return  "Desember";
        break;
    }
    }
    function right($value, $count){
    return substr($value, ($count*-1));
    }

    function left($string, $count){
    return substr($string, 0, $count);
    }

    function  dotrek($rek){
				$nrek=strlen($rek);
				switch ($nrek) {
                case 1:
				$rek = $this->left($rek,1);								
       			 break;
    			case 2:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1);								
       			 break;
    			case 3:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1);								
       			 break;
    			case 5:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2);								
        		break;
    			case 7:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2).'.'.substr($rek,5,2);								
        		break;
    			default:
				$rek = "";	
				}
				return $rek;
    }
	

	
    
     function preview_rka0(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
     function preview_dpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '2.2' AS NO ,'Belanja langsung' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)<>'00' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,'.',',');
                    $triw2= number_format($triw->triw2,2,'.',',');
					$triw3= number_format($triw->triw3,2,'.',',');
					$triw4= number_format($triw->triw4,2,'.',',');
					$total= number_format($triw->jumlah,2,'.',',');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_dppa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Satuan Kerja Perangkat daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" rowspan=\"2\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"46%\" align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"46%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,'.',',');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td></tr>";
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '2.2' AS NO ,'Belanja langsung' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)<>'00' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,'.',',');
                    $triw2= number_format($triw->triw2,2,'.',',');
					$triw3= number_format($triw->triw3,2,'.',',');
					$triw4= number_format($triw->triw4,2,'.',',');
					$total= number_format($triw->jumlah,2,'.',',');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_dppa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" rowspan=\"2\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"46%\" align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"46%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518')) and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,',','.');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $rek=$row2->rek;
                    $uraian=$row2->nm_rek;
                    $nilai= number_format($row2->nilai,"2",",",".");
                    $nilai_u= number_format($row2->nilai_u,"2",",",".");
                    $n=$row2->nilai;
                    $n_u=$row2->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                    $pm_u=$rowpm->totpm_u;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                    $pk_u=$rowpk->totpk_u;
                   
                 }
                    
                  $pmnetto=$pm-$pk;
                  $pmnett=number_format($pmnetto,2,',','.');
                  $pmnetto_u=$pm_u-$pk_u;
                  $pmnett_u=number_format($pmnetto_u,2,',','.');
                  $netto= $pmnetto_u - $pmnetto;
                  if ($netto < 0){
                	$a1="(";
                	$netto=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettoo=number_format($netto,2,',','.');
                    $pers   = ($netto!=0)?($netto / $pmnetto ) * 100:0; 
                    $p= number_format($per1,"2",".",","); 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$a1$nettoo$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$p</td>
                                     </tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     </tr>";
                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"25%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"71%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"14%\" style=\"text-align: center;\">I </td>
                                <td width=\"14%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '3.1' AS NO ,'Pembiayaan Masuk' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.03' AND kd_skpd='$id'
                    UNION
                    SELECT '3.2' AS NO ,'Pembiayaan Keluar' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_rka0pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Ringkasan Anggaran Pendapatan dan Belanja PPKD</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 }
                 
                 $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                 
                 $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                   
                 }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $netto=number_format($pmnetto,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                   
                 }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $netto=number_format($pmnetto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                              UNION
                              SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                              UNION
                              SELECT '3.1' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'
                              UNION
                              SELECT '3.2' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    
    function preview_rka1(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENDAPATAN
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
        function preview_dppa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan Satuan Kerja Perangkat Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka1pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Rincian Anggaran Pendapatan Ppejabat Pengelola Keuangan Daerah</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - ppkd 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENDAPATAN
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka21(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH </td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA TIDAK LANGSUNG
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Satuan Kerja Perangkat Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka21pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA TIDAK LANGSUNG
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka22(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 22  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td width=\"100%\" align=\"center\" colspan=\"2\">Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"36%\" align=\"center\"><b>Tanun n</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Tahun n+1</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Belanja Pegawai</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Barang & Jasa</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Modal</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (
SELECT a.kd_program AS prog,a.kd_program AS prog1,' ' AS giat,b.nm_program AS uraian, ' ' AS lokasi,' 'AS target,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS bljpeg,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS bljbrg,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS bljmdl,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_prog b ON a.kd_program1=b.kd_program 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd ='$id' GROUP BY a.kd_program
UNION 
SELECT a.kd_program AS prog,' ' AS prog1,a.kd_kegiatan AS giat,b.nm_kegiatan AS uraian, ' ' AS lokasi,' 'AS target,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_kegiatan = a.kd_kegiatan) AS bljpeg,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='522'AND kd_kegiatan = a.kd_kegiatan)  AS bljbrg,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='523'AND kd_kegiatan = a.kd_kegiatan ) AS bljmdl,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd ='$id' GROUP BY a.kd_kegiatan) a ORDER BY a.prog,a.giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }
                    
                
        
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD 2.2  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Sumber Dana</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"32%\" align=\"center\"><b>Triwilan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" align=\"center\"><b>Jumlah (Rp)</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">I</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">II</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">III</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">IV</td>
                        </tr>    
                     </thead>

                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td></tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (
SELECT a.kd_program AS prog,a.kd_program AS prog1,' ' AS giat,b.nm_program AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
' ' AS triw1,' ' AS triw2,' ' AS triw3,' ' AS triw4,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_prog b ON a.kd_program1=b.kd_program 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_program
UNION 
SELECT a.kd_program AS prog,' ' AS prog1,a.kd_kegiatan AS giat,b.nm_kegiatan AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
(SELECT triw1 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw1,
(SELECT triw2 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan)  AS triw2,
(SELECT triw3 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw3,
(SELECT triw4 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw4,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_kegiatan
)
a ORDER BY a.prog,a.giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $sumber=$row->sumber;
                    $triw1=empty($row->triw1) || $row->triw1 == 0 ? '' :number_format($row->triw1,2,',','.');
                    $triw2=empty($row->triw2) || $row->triw2 == 0 ? '' :number_format($row->triw2,2,',','.');
                    $triw3=empty($row->triw3) || $row->triw3 == 0 ? '' :number_format($row->triw3,2,',','.');
                    $triw4=empty($row->triw4) || $row->triw4 == 0 ? '' :number_format($row->triw4,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$sumber</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                
                $query2="SELECT SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 FROM trskpd WHERE jns_kegiatan='52' AND kd_skpd='$id'";
                $sqltw=mysql_query("$query2");
                    while($t  =  mysql_fetch_array($sqltw)){
                        $tottw1= empty($t['triw1']) || $t['triw1'] == 0 ? '' : number_format($t['triw1'],2,',','.');
                        $tottw2= empty($t['triw2']) || $t['triw2'] == 0 ? '' : number_format($t['triw2'],2,',','.');
                        $tottw3= empty($t['triw3']) || $t['triw3'] == 0 ? '' : number_format($t['triw3'],2,',','.');
                        $tottw4= empty($t['triw4']) || $t['triw4'] == 0 ? '' : number_format($t['triw4'],2,',','.');
                    
                
                $cRet    .="<tr>
				          		     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                    
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >JUMLAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
			                  
							  </tr>" ;    
                
                }
                $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"11\">
								<table border=\"0\">
								<tr>
								<td width=\"100%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD 2.2  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Sumber Dana</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">Sebelum Perubahan</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">Setelah Perubahan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>    
                     </thead>
                    
                   ";
                        
                 $sql1="SELECT * FROM (
                        SELECT a.kd_program AS prog,a.kd_program AS prog1,' ' AS giat,b.nm_program AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS jumlah ,
                        (SELECT SUM(nilai_ubah) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LENGTH(a.kd_program))= a.kd_program) AS jumlah_u 
                        FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_prog b ON a.kd_program1=b.kd_program 
                        WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_program
                        UNION 
                        SELECT a.kd_program AS prog,' ' AS prog1,a.kd_kegiatan AS giat,b.nm_kegiatan AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah ,
                        (SELECT SUM(nilai_ubah) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah_u
                        FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan 
                        WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_kegiatan)
                        a ORDER BY a.prog,a.giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $sumber=$row->sumber;                    
                    $nilai=empty($row->jumlah) || $row->jumlah == 0 ? '' :number_format($row->jumlah,2,',','.');
                    $nilai_u=empty($row->jumlah_u) || $row->jumlah_u == 0 ? '' :number_format($row->jumlah_u,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $n=$row->jumlah;
                    $n_u=$row->jumlah_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$sumber</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td>
                                     
                                     </tr>
                                     ";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>";
                 }
                
                $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">
								<table border=\"0\">
								<tr>
								<td width=\"100%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA22.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    
    
    function preview_dpa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 31  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENERIMAAN PEMBIAYAAN  </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='61') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    function preview_dppa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Masuk </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='61' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dpa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENGELUARAN PEMBIAYAAN  </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='62') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 3.2  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Keluar</strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='62' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    
    function daftar_kegiatan($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list', $data);
	}
    function daftar_kegiatan1($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dpa', $data);
	}
    
    function preview_rka221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        //echo"$giat";
        //$sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
//                 $sqlskpd=$this->db->query($sqldns);
//                 foreach ($sqlskpd->result() as $rowdns)
//                {
//                   
//                    $kd_urusan=$rowdns->kd_u;                    
//                    $nm_urusan= $rowdns->nm_u;
//                    $kd_skpd  = $rowdns->kd_sk;
//                    $nm_skpd  = $rowdns->nm_sk;
//                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program1=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    //$tu_capai  = $roworg->$tu_capai;
//                    $tu_mas  = $roworg->$tu_mas;
//                    $tu_kel  = $roworg->$tu_kel;
//                    $tu_has  = $roworg->$tu_has;
//                    $tk_capai  = $roworg->$tk_capai;
//                    $tk_mas  = $roworg->$tk_mas;
//                    $tk_kel  = $roworg->$tk_kel;
//                    $tk_has  = $roworg->$tk_has;
                }
        $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 221  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Jumlah Tahun n - 1<br>&nbsp;
								Jumlah Tahun <br>&nbsp;
								Jumlah Tahun n + 1
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								: $lokasi<br>
								: Rp.<br>
								: Rp. $totp<br>
								: Rp.
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                                          
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
GROUP BY LEFT(a.kd_rek5,1) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
 UNION ALL  
 SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
 UNION ALL 
 SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
 UNION ALL 
 SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                  
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        //echo"$giat";
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program1=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    //$tu_capai  = $roworg->$tu_capai;
//                    $tu_mas  = $roworg->$tu_mas;
//                    $tu_kel  = $roworg->$tu_kel;
//                    $tu_has  = $roworg->$tu_has;
//                    $tk_capai  = $roworg->$tk_capai;
//                    $tk_mas  = $roworg->$tk_mas;
//                    $tk_kel  = $roworg->$tk_kel;
//                    $tk_has  = $roworg->$tk_has;
                }
        $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Waktu Pelaksanaan<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Sumber Dana <br>&nbsp;
								
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								: <br>
								: $lokasi<br>
								: <br>
								
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                                          
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
GROUP BY LEFT(a.kd_rek5,1) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
 UNION ALL  
 SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
 UNION ALL 
 SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
 UNION ALL 
 SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                  
                 
                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function daftar_kegiatan2($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dppa', $data);
	}
    
    function preview_dppa221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program1=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tk_has  = $roworg->tk_has;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Waktu Pelaksanaan<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Sumber Dana &nbsp;								
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								: <br>
								: $lokasi<br>
								: <br>
								
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td rowspan=\"2\" width=\"18%\" align=\"center\">Indikator </td>
                 <td colspan=\"2\" width=\"44%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td colspan=\"2\" width=\"34%\" align=\"center\">Target Kinerja </td>
                </tr>";
        $cRet .="<tr align=\"center\">
   		           <td align=\"center\" width=\"22%\">Sebelum Perubahan</td>
   		           <td align=\"center\" width=\"22%\">Setelah Perubahan</td>
   		           <td align=\"center\" width=\"19%\">Sebelum Perubahan</td>
                   <td align=\"center\" width=\"19%\">Setelah Perubahan</td>
  		        </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
    
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,
                        a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE kd_kegiatan='$giat'  AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka31(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 31  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENERIMAAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='61') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Penerimaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);            
               
    }
    
    function preview_rka32(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENGELUARAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='62') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT no as no,nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$rowtim->no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
       
    }
    
    function preview_perda1dns(){
      
      
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    function tes(){

            $data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            $lc = "select kd_skpd,nm_skpd from ms_skpd order by kd_skpd";
            $query = $this->db->query($lc);
            $data["skpd"]=$query->result();
            
        
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/tes',$data);
        
                
    }
    
     function preview_perda1(){
       $id = $this->uri->segment(3);
       
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
         function preview_perda1pdf(){
       $id = $this->uri->segment(3);
      
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
           
      
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>BUPATI/WALIKOTA,
      							<p>&nbsp;</p>
                				<br>JAKA SONJAYA
                				<br>NIP. 30707
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
    function preview_perda1_skpd(){
      $id = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
      // echo "$cetak";
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA'); 
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perda1_skpd',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perda1_skpd', $data);
        break;
        }
        
                
    }
    
         function preview_perda1_skpdpdf(){
 $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>BUPATI/WALIKOTA,
      							<p>&nbsp;</p>
                				<br>JAKA SONJAYA
                				<br>NIP. 30707
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
    
    function preview_perdaII(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">TIDAK LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah  FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS pendapatan,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->pendapatan,"2",".",",");
                    $btl= number_format($row->btl,"2",".",",");
                    $bl= number_format($row->bl,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaII',$data);
        
                
    }
    
    function preview_perdaIIpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">TIDAK LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                 
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4') AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51') AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS pendapatan,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->pendapatan,"2",".",",");
                    $btl= number_format($row->btl,"2",".",",");
                    $bl= number_format($row->bl,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaII',$data);
        
                
    }
    
    function preview_perdaIII(){
      $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->kd_rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->kd_rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LENGTH(a.kd_program))) WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->kd_rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->kd_rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                 }  
                  
                  //$netto=$cob3-$cob4; 
//                  if ($netto < 0){
//                	$a1="(";
//                	$suplus=$netto*-1;
//                	$b1=")";}
//                  else {
//                	$a1="";
//	                $b1="";}
//                 $nett=number_format($netto,2,',','.');  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
//                    $silpa=($cob1+$cob3)-($cob+$cob4);
//                     if ($silpa < 0){
//                	$c1="(";
//                	$silpa=$silpa*-1;
//                	$d1=")";}
//                    else {
//                	$c1="";
//	                $d1="";}
//                 $silp=number_format($silpa,2,',','.');                  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
       
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaIII',$data);
        
                
    }
    
    function preview_perdaIIIpdf(){
      $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                               
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->kd_rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->kd_rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LENGTH(a.kd_program))) WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->kd_rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->kd_rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                 }  
                  
                  //$netto=$cob3-$cob4; 
//                  if ($netto < 0){
//                	$a1="(";
//                	$suplus=$netto*-1;
//                	$b1=")";}
//                  else {
//                	$a1="";
//	                $b1="";}
//                 $nett=number_format($netto,2,',','.');  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
//                    $silpa=($cob1+$cob3)-($cob+$cob4);
//                     if ($silpa < 0){
//                	$c1="(";
//                	$silpa=$silpa*-1;
//                	$d1=")";}
//                    else {
//                	$c1="";
//	                $d1="";}
//                 $silp=number_format($silpa,2,',','.');                  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perdaIII',$data);
        
                
    }
    
    function preview_perdaIV(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522')AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523') AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        ) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->bpeg,"2",".",",");
                    $btl= number_format($row->bbj,"2",".",",");
                    $bl= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaIV',$data);
        
                
    }
    
    function preview_perdaIVpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                    </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522')AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523') AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        ) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->bpeg,"2",".",",");
                    $btl= number_format($row->bbj,"2",".",",");
                    $bl= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaIV',$data);
        
                
    }
    
    function preview_perdaV(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">LAINNYA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=number_format($row->bbtl,"2",".",",");
                    $bppkd= number_format($row->bppkd,"2",".",",");
                    $bpeg= number_format($row->bpeg,"2",".",",");
                    $bbj= number_format($row->bbj,"2",".",",");
                    $bm= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaV',$data);
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
    function preview_perdaVpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">LAINNYA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                    </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=number_format($row->bbtl,"2",".",",");
                    $bppkd= number_format($row->bppkd,"2",".",",");
                    $bpeg= number_format($row->bpeg,"2",".",",");
                    $bbj= number_format($row->bbj,"2",".",",");
                    $bm= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaV',$data);
        
                
    }
    
    function preview_perkada(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PENJABARAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH (Rp.)</b></td>
                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>PENJELASAN</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"17%\" bgcolor=\"#CCCCCC\" align=\"center\">URAIAN</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">VOLUME</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">SATUAN</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">HARGA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">TOTAL</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                                       
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                 $sql1="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '5' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,1)='4') a ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                  
                 $sql2="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='51'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql3="SELECT * FROM (SELECT a.kd_program AS kd_rek, a.kd_program AS kd_rek1,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trskpd a INNER JOIN m_prog c ON a.kd_program1=c.kd_program
                        LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LENGTH(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_program,c.nm_program 
                        UNION ALL
                        SELECT a.kd_kegiatan AS kd_rek,a.kd_kegiatan AS kd_rek1,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'5' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'6' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total,'7' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='52'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Belanja </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $bljpm1=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql4="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='61'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                                     
                
        
                  }
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                  }                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 
                 
                 $sql5="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='62'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $netto=$bljpm1-$bljpk1;
                   if ($netto < 0){
                	$x1="(";
                	$netto=$netto*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $net=number_format($netto,2,',','.');  
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$net$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
    function preview_perda1_ubah(){
       $id = $this->uri->segment(3);
       $cetak = $this->uri->segment(4);
             
       if ($id <> 'keseluruhan' ) {
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
                
         $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       }
       
       if ($id <> 'keseluruhan') {
           $skpd1 = "and kd_skpd='$id'";
           $skpd2 = " and b.kd_skpd='$id'";
           
       } else {
           $skpd1 = '';
           $skpd2 = '';
            
       }
       
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN I  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        if ($id <> 'keseluruhan') {
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                        <tr>
                            <td width=\"20%\">Urusan Organisasi </td>
                            <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td>Organisasi</td>
                            <td>: $kd_skpd - $nm_skpd</td>
                        </tr>
                    
                    </table>";      
        }
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\" colspan=\"2\" ><b>JUMLAH (Rp.)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        <tr >
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Penyusunan</b></td>
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Perubahan</b></td>                             
                        </tr>  
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                        
               
                   $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='4'  $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='4'  $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='4'  $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
               
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_u,"2",".",",");
                    $rumus1 = $row->nilai_u - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");                                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen1</td>
                                 </tr>";
                }
              
                $sqltp="SELECT SUM(nilai) AS totp,Sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' $skpd1 ";
                
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4   =   number_format($rowp->totp,"2",".",",");
                   $coba4u  =   number_format($rowp->totp_u,"2",".",",");
                   $rumus2  =   $rowp->totp_u - $rowp->totp;                   
                   if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");     
                    $cob1   =$rowp->totp;
                    $cob1u  =$rowp->totp_u;
                    $per2   = ($rumus2!=0)?($rumus2/$rowp->totp) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen2</td>
                                 </tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }
                
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='5' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='5' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='5' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_u,"2",".",",");
                    $rumus3 = $row1->nilai_u - $row1->nilai;
                    if ($rumus3 < 0){
                    	$x1="(";
                    	$rumus3=$rumus3*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total3 = number_format($rumus3,"2",".",",");     
                    $per3   = ($rumus3!=0)?($rumus3 /$row1->nilai ) * 100:0; 
                    $persen3= number_format($per3,"2",".",",");
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen3</td>
                                  </tr>";
                }
                   
                 $sqltb="SELECT SUM(nilai) AS totb,sum(nilai_ubah) as totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' $skpd1 ";                                           
                    
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $coba8  =   number_format($rowb->totb,"2",".",",");
                    $coba8u =   number_format($rowb->totb_u,"2",".",",");
                    $rumus4 =   $rowb->totb_u - $rowb->totb;
                    if ($rumus4 < 0){
                    	$x1="(";
                    	$rumus4=$rumus4*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total4 = number_format($rumus4,"2",".",",");
                    $cob=$rowb->totb;
                    $cobu=$rowb->totb_u;
                    $per4   = ($rumus4!=0)?($rumus4 /$rowb->totb ) * 100:0; 
                    $persen4= number_format($per4,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen4</td>
                                </tr>";
                 } 
                  
                  $suplus=$cob1-$cob;
                  $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surpu$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                   
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LENGTH(a.kd_rek1))) where left(a.kd_rek1,1)='6' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='61' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='61' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                            
                    
                    
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  = $row3->rek;
                    $coba10 = $row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_u,"2",".",",");
                    $rumus5 = $row3->nilai_u - $row3->nilai;
                    if ($rumus5 < 0){
                    	$x1="(";
                    	$rumus5=$rumus5*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total5 = number_format($rumus5,"2",".",",");
                    $per5   = ($rumus5!=0)?($rumus5 /$row3->nilai) * 100:0; 
                    $persen5= number_format($per5,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen5</td>    
                                 </tr>";
                }
                
                    $sqltpm="SELECT SUM(nilai) AS totpm, SUM(nilai_ubah) as totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' $skpd1 ";
                
                
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_u,"2",".",",");
                   $rumus6  = $rowpm->totpm_u - $rowpm->totpm;
                   if ($rumus6 < 0){
                    	$x1="(";
                    	$rumus6=$rumus6*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total6 = number_format($rumus6,"2",".",",");
                   $cob3   =$rowpm->totpm;
                   $cob3u  =$rowpm->totpm_u;
                   $per6   = ($rumus6!=0)?($rumus6 /$rowpm->totpm) * 100:0; 
                   $persen6= number_format($per6,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen6</td>
                                </tr>";
                }
                
                $sql4="sELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LENGTH(a.kd_rek2))) where left(a.kd_rek2,2)='62' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LENGTH(a.kd_rek3))) where left(a.kd_rek3,2)='62' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                    
                
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13  = $row4->rek;
                    $coba14  = $row4->nm_rek;
                    $coba15  = number_format($row4->nilai,"2",".",",");
                    $coba15u = number_format($row4->nilai_u,"2",".",",");
                    $rumus7  = $row4->nilai_u - $row4->nilai;
                    if ($rumus7 < 0){
                    	$x1="(";
                    	$rumus7=$rumus7*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total7 = number_format($rumus7,"2",".",",");
                   $per7   = ($rumus7!=0)?($rumus7 /$row4->nilai) * 100:0; 
                   $persen7= number_format($per7,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen7</td>
                                 </tr>";
                }
             
                    $sqltpk="SELECT SUM(nilai) AS totpk, SUM(nilai) as totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' $skpd1 ";    

                
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_u,"2",".",",");
                   $rumus8  = $rowpk->totpk_u - $rowpk->totpk;
                   if ($rumus8 < 0){
                    	$x1="(";
                    	$rumus8=$rumus8*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total8 = number_format($rumus8,"2",".",",");
                   $cob4=$rowpk->totpk;
                   $cob4u=$rowpk->totpk_u;
                   $per8   = ($rumus8!=0)?($rumus8 /$rowpk->totpk) * 100:0; 
                   $persen8= number_format($per8,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen8</td>
                                </tr>";
                 }  
                  
                  $netto=$cob3-$cob4;
                  $nettou=$cob3u-$cob4u; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.'); 
                 if ($nettou < 0){
                	$a1="(";
                	$nettou=$nettou*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettu=number_format($nettou,2,',','.');
                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nett$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nettu$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                    if ($silpa < 0){
                    	$c1="(";
                    	$silpa=$silpa*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silp=number_format($silpa,2,',','.');
                    $silpau=($cob1u+$cob3u)-($cobu+$cob4u);
                    if ($silpau < 0){
                    	$c1="(";
                    	$silpau=$silpau*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silpu=number_format($silpau,2,',','.');                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"40%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silp$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silpu$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                  </tr>
                                  ";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet         .= "</table>";
        $data['prev']  = $cRet;
        $data['sikap'] = 'preview';
        if ($id <> 'keseluruhan') {
            $judul         = 'Laporan APBD Perubahan lampI - '.$kd_skpd;
        } else {
            $judul         = 'Laporan APBD Perubahan lampI - Keseluruhan';
        }
        
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN I');    
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perda_1_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
                
    }
    
    function preview_perdaII_ubah($cetak=0){
        //$cetak =   $this->uri->segment(3);           
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                
        $cRet  ='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN II  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"4\"><b>PENDAPATAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"54%\" align=\"center\" colspan=\"8\"><b>BELANJA</b></td>
                        </tr>
                        <tr>
 		                    <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                        </tr>
                        <tr>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" >&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,a.kd_urusan1 AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,a.kd_urusan AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan WHERE LENGTH(kd_urusan) <> '1' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, a.nm_skpd AS nama,a.kd_skpd AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_skpd a ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,a.nm_skpd
                        UNION
                        SELECT '' AS kode, 'JUMLAH' AS nama,'JUMLAH' AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' ) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51') AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1) a ORDER BY a.urut
                        ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   =$row->kode;
                    $nama   =$row->nama;
                    $pend   =number_format($row->nilai,"2",".",",");
                    $pendu  =number_format($row->nilai_ubah,"2",".",",");
                    $rumus1  = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                    $btl    = number_format($row->btl,"2",".",",");
                    $bl     = number_format($row->bl,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $btlu   = number_format($row->btl_ubah,"2",".",",");
                    $blu    = number_format($row->bl_ubah,"2",".",",");
                    $jumu   = number_format($row->jumlah_ubah,"2",".",",");
                    $rumus2 = ($row->jumlah_ubah - $row->jumlah);
                    if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");
                    $per2   = ($rumus2!=0)?($rumus2 / $row->jumlah ) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");    
                    
                     $cRet    .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"5%\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"15%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btl</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen2</td>
                                </tr>
                                     ";
                
        
                  }  

        $cRet          .=       " </table>";

        $data['prev']  = $cRet;
        
        $judul = 'Laporan APBD Perubahan Lamp II';
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II'); 
                    
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                
    }
    
    function preview_perdaIII_ubah(){
      $id    = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN III:</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>: $kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>URAIAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Sebelum Perubahan</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>(Rp.)</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->kd_rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_ubah,"2",".",",");
                    $rumus1 = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp, SUM(nilai_ubah) as totp_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                   $coba4u=number_format($rowp->totp_ubah,"2",".",",");
                   $rumus2 = $rowp->totp_ubah - $rowp->totp;
                   if ($rumus2 < 0){
                        $x1="("; $rumus2=$rumus2*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total2 = number_format($rumus2,"2",".",",");  
                   $per2   = ($rumus2!=0)?($rumus2 / $rowp->totp ) * 100:0; 
                   $persen2= number_format($per2,"2",".",",");
                   $cob1=$rowp->totp;
                   $cob1u=$rowp->totp_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) as totb_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                   $jmlbu=number_format($rowb->totb_ubah,"2",".",",");
                   $cob=$rowb->totb;
                   $cobu=$rowb->totb_ubah;
                   $rumus3 = $rowb->totb_ubah - $rowb->totb;
                   if ($rumus3 < 0){
                        $x1="("; $rumus3=$rumus3*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total3 = number_format($rumus3,"2",".",",");  
                   $per3   = ($rumus3!=0)?($rumus3 / $rowb->totb ) * 100:0; 
                   $persen3= number_format($per3,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">BELANJA DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlbu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->kd_rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_ubah,"2",".",",");
                    $rumus4 = $row1->nilai_ubah - $row1->nilai;
                    if ($rumus4 < 0){
                        $x1="("; $rumus4=$rumus4*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total4 = number_format($rumus4,"2",".",",");  
                   $per4   = ($rumus4!=0)?($rumus4 / $row1->nilai) * 100:0; 
                   $persen4= number_format($per4,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                ";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl, SUM(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus5  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus5 < 0){
                        $x1="("; $rumus5=$rumus5*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total5 = number_format($rumus5,"2",".",",");  
                   $per5   = ($rumus5!=0)?($rumus5 / $rowbl->totbl) * 100:0; 
                   $persen5= number_format($per5,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen5</td>                                
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,
              			  (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai,
             			  (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai_ubah
            			  FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LENGTH(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai) AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1    =$row1bl->kd_rek;
                    $bl2    =$row1bl->nm_rek;
                    $bl3    = number_format($row1bl->nilai,"2",".",",");
                    $bl3u   = number_format($row1bl->nilai_ubah,"2",".",",");
                    $rumus6 = $row1bl->nilai_ubah - $row1bl->nilai;
                    if ($rumus6 < 0){
                        $x1="("; $rumus6=$rumus6*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total6 = number_format($rumus6,"2",".",",");  
                    $per6   = ($rumus6!=0)?($rumus6 / $row1bl->nilai) * 100:0; 
                    $persen6= number_format($per6,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl,Sum(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus7  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus7 < 0){
                        $x1="("; $rumus7=$rumus7*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total7 = number_format($rumus7,"2",".",",");  
                    $per7   = ($rumus7!=0)?($rumus7 / $rowbl->totbl) * 100:0; 
                    $persen7= number_format($per7,"2",".",",");
                   $cob=$rowbl->totbl;
                   $cobu=$rowbl->totbl_ubah;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 
                 $suplus=$cob1-$cob;
                 $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');               
                  
                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Suprlus/(Defisit)</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surp$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surpu$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">PEMBIAYAAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  =$row3->kd_rek;
                    $coba10 =$row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_ubah,"2",".",",");
                    $rumus8 = $row3->nilai_ubah - $row3->nilai;
                    if ($rumus8 < 0){
                        $x1="("; $rumus8=$rumus8*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total8 = number_format($rumus8,"2",".",",");  
                    $per8   = ($rumus8!=0)?($rumus8 / $row3->nilai) * 100:0; 
                    $persen8= number_format($per8,"2",".",",");
                    
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_ubah,"2",".",",");
                   $rumus9  = $rowpm->totpm_ubah - $rowpm->totpm;
                   if ($rumus9 < 0){
                        $x1="("; $rumus9=$rumus9*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total9 = number_format($rumus9,"2",".",",");  
                    $per9   = ($rumus9!=0)?($rumus9 / $rowpm->totpm) * 100:0; 
                    $persen9= number_format($per9,"2",".",",");
                    $cob3    = $rowpm->totpm;
                    $cob3u   = $rowpm->totpm_ubah;
                     $cRet    .= " 
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total9$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen9</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13     = $row4->kd_rek;
                    $coba14     = $row4->nm_rek;
                    $coba15     = number_format($row4->nilai,"2",".",",");
                    $coba15u    = number_format($row4->nilai_ubah,"2",".",",");
                    $rumus10    = $row4->nilai_ubah - $row4->nilai;
                    if ($rumus10 < 0){
                        $x1="("; $rumus10=$rumus10*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total10 = number_format($rumus10,"2",".",",");  
                    $per10   = ($rumus10!=0)?($rumus10 / $row4->nilai) * 100:0; 
                    $persen10= number_format($per10,"2",".",",");
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total10$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen10</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_ubah,"2",".",",");
                   $rumus11 = $rowpk->totpk_ubah - $rowpk->totpk;
                   if ($rumus11 < 0){
                        $x1="("; $rumus11=$rumus11*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total11 = number_format($rumus11,"2",".",",");  
                    $per11   = ($rumus11!=0)?($rumus11 / $rowpk->totpk) * 100:0; 
                    $persen11= number_format($per11,"2",".",",");
                    
                   $cob4    =$rowpk->totpk;
                   $cob4u   =$rowpk->totpk_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\">Jumlah Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$x1$total11$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen11</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                 }  
                  

              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul     = 'Laporan APBD Perubahan Lamp III - '.$kd_skpd;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        switch($cetak) {
        case 0;
              $this->template->load('template','anggaran/rka/perdaIII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }       
       
        
                
    }
    
    
    function preview_perdaIV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN IV  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI PERUBAHAN BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH, ORGANISASI, PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"22%\" align=\"center\"><b>URAIAN URUSAN, ORGANISASI, PROGRAM DAN KEGIATAN PEMERINTAH DAERAH</b></td>                            
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SEBELUM PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SETELAH PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                        </tr>
                        <tr>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"22%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlahu,a.kd_urusan1 AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpegu
                        ,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlahu,a.kd_urusan AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbju, 
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlahu,LEFT(b.kd_skpd,7) AS urut FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LENGTH(b.kd_program)))=b.kd_program ) AS jumlahu,
                        a.kd_skpd AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlahu,
                        SUBSTRING(b.kd_kegiatan,6,13) AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlahu,'JUMLAH' AS urut FROM trdrka) a ORDER BY urut,kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   = $row->kode;
                    $nama   = $row->nama;
                    $pend   = number_format($row->bpeg,"2",".",",");
                    $btl    = number_format($row->bbj,"2",".",",");
                    $bl     = number_format($row->bm,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $pendu  = number_format($row->bpegu,"2",".",",");
                    $btlu   = number_format($row->bbju,"2",".",",");
                    $blu    = number_format($row->bmu,"2",".",",");
                    $jumu   = number_format($row->jumlahu,"2",".",",");
                    $rumus1 = $row->jumlahu - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"22%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen1</td>
                                </tr> ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp IV ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN IV');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaIV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                                              
    }
    
    function preview_perdaV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN IV  </h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5></strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"15%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"15%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SEBELUM PERUBAHAN</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SETELAH PERUBAHAN</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"19%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>    
                     </thead>
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                        (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah,
                        (SELECT SUM(a.nilai_ubah) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah_u FROM trdrka a  INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah_u FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,'99' AS kode1,'3' AS kode2,'' AS skpd,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5') AS jumlah,                                          
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_u FROM trdrka) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $jumlah=number_format($row->jumlah,"2",".",",");
                    $jumlah_u= number_format($row->jumlah_u,"2",".",",");
                    $rumus1 = $row->jumlah_u - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",","); 
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$persen1</td>
                                    </tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp V ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN V');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
                
    }
    
    function preview_perkada_ubah(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PENJABARAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"17%\" align=\"center\"><b>Uraian</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td>
                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Penjelasan</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Sebelum Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Setelah Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                             <td width=\"18%\" bgcolor=\"#CCCCCC\" align=\"center\">Uraian</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                             <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Harga</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Total</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                                       
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $pen=$rowp->totp;
                    $pend_u=number_format($rowp->totp_u,"2",".",",");
                    $pen_u=$rowp->totp_u;
                    $pend_s = $rowp->totp_u - $rowp->totp;
                    if ($pend_s < 0){
                    	$x1="("; $pend_s=$pend_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pend_selisih = number_format($pend_s,"2",".",",");
                    $per1   = ($pend_s!=0)?($pend_s / $rowp->totp ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 $sql1="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' AS nilai_u,uraian AS uraian,volume_ubah1 AS volume,satuan_ubah1 AS satuan,harga_ubah1 AS harga,total_ubah AS total, '5' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,1)='4') a ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nu=$row->nilai_u;
                    $n=$row->nilai;
                    $nilaip_s = $nu - $n;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                                       
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none; border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                   $blj1=$rowb->totb;
                   $blj_u=number_format($rowb->totb,"2",".",",");
                   $blj_u1=$rowb->totb_u;
                   $blj_s = $rowb->totb_u - $rowb->totb;
                    if ($blj_s < 0){
                    	$x1="("; $blj_s=$blj_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $blj_selisih = number_format($blj_s,"2",".",",");
                    $per1_blj  = ($pend_s!=0)?($blj_s / $rowb->totb ) * 100:0; 
                    $persen_blj= number_format($per1_blj,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl,SUM(nilai_ubah) AS totbtl_u FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                   $bljbtl1=$rowbtl->totbtl;
                   $bljbtl_u=number_format($rowbtl->totbtl_u,"2",".",",");
                   $bljbtl1_u=$rowbtl->totbtl_u;
                   $btl_s = $rowbtl->totbtl_u - $rowbtl->totbtl;
                    if ($btl_s < 0){
                    	$x1="("; $btl_s=$btl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $btl_selisih = number_format($btl_s,"2",".",",");
                    $per1_btl  = ($pend_s!=0)?($btl_s / $rowbtl->totbtl ) * 100:0; 
                    $persen_btl= number_format($per1_btl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$btl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_btl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                  
                 $sql2="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='51'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaip_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl,SUM(nilai_ubah) AS totbl_u FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                   $bljbl1=$rowbtl->totbtl;
                   $bljbl_u=number_format($rowbl->totbl_u,"2",".",",");
                   $bljbl1_u=$rowbl->totbl_u;
                   $bl_s = $bljbl1_u - $bljbl1;
                    if ($bl_s < 0){
                    	$x1="("; $bl_s=$bl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $bl_selisih = empty($bl_s) || $bl_s == 0 ? '' :number_format($bl_s,"2",".",",");
                    $per1_bl  = ($pend_s!=0)?($bl_s / $rowbl->totbl ) * 100:0; 
                    $persen_bl= empty($per1_bl) || $per1_bl == 0 ? '' :number_format($per1_bl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$bl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_bl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 
                 $sql3="SELECT * FROM (SELECT a.kd_program AS kd_rek, a.kd_program AS kd_rek1,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(LENGTH(a.kd_program))) = a.kd_program) AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trskpd a INNER JOIN m_prog c ON a.kd_program1=c.kd_program
                        LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LENGTH(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_program,c.nm_program 
                        UNION ALL
                        SELECT a.kd_kegiatan AS kd_rek,a.kd_kegiatan AS kd_rek1,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'5' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'6' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' 'AS nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total,'7' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='52'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaib_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaib_s=$nilaib_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaib_selisih = empty($nilaib_s) || $nilaib_s == 0 ? '' :number_format($nilaib_s,"2",".",",");
                    $perb   = ($nilaib_s!=0)?($nilaib_s / $row->nilai ) * 100:0; 
                    $persenb= empty($perb) || $perb == 0 ? '' :number_format($perb,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaib_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenb</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $pm=$rowpm->totpm;
                   $bljpm_u=number_format($rowpm->totpm_u,"2",".",",");
                   $pm_u=$rowpm->totpm_u;                   
                    $pm_s = $pm_u - $pm;
                    if ($pm_s < 0){
                    	$x1="("; $pm_s=$pm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pm_selisih = number_format($pm_s,"2",".",",");
                    $per1_pm  = ($pend_s!=0)?($pm_s / $rowpm->totpm ) * 100:0; 
                    $persen_pm= number_format($per1_pm,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                 }
                 
                 $sql4="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='61'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaipm_s = $row->nilai_u - $row->nilai;
                    if ($nilaipm_s < 0){
                    	$x1="("; $nilaipm_s=$nilaipm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipm_selisih = empty($nilaipm_s) || $nilaipm_s == 0 ? '' :number_format($nilaipm_s,"2",".",",");
                    $perpm   = ($nilaipm_s!=0)?($nilaipm_s / $row->nilai ) * 100:0; 
                    $persenpm= empty($perpm) || $perpm == 0 ? '' :number_format($perpm,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   $bljpk_u=number_format($rowpk->totpk_u,"2",".",",");
                   $bljpk1_u=$rowpk->totpk_u;                   
                   $pk_s = $bljpk1_u - $bljpk1;
                    if ($pk_s < 0){
                    	$x1="("; $pk_s=$pk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pk_selisih = number_format($pk_s,"2",".",",");
                    $per1_pk  = ($pend_s!=0)?($pk_s / $rowpk->totpk ) * 100:0; 
                    $persen_pk= number_format($per1_pk,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                  }                   
                    
                 
                 
                 $sql5="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='62'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $pk=$row->nilai;
                    $pk_u=$row->nilai_u;
                    $nilaipk_s = $pk_u -$pk;
                    if ($nilaipk_s < 0){
                    	$x1="("; $nilaipk_s=$nilaipk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipk_selisih = empty($nilaipk_s) || $nilaipk_s == 0 ? '' :number_format($nilaipk_s,"2",",",".");
                    $perpk   = ($nilaipk_s!=0)?($nilaipk_s / $row->nilai ) * 100:0; 
                    $persenpk= empty($perpk) || $perpk == 0 ? '' :number_format($perpk,"2",",",".");
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $netto=$pm - $pk;
                  $net=number_format($netto,"2",",",".");
                  $netto_u=$pm_u - $pk_u;
                  $net_u=number_format($netto_u,"2",",",".");
                  $netto_s=$netto_u - $netto;
                  if ($netto_s < 0){
                    	$x1="("; $netto_s=$netto_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $netto_selisih = number_format($netto_s,"2",",",".");
                    $perpnet   = ($netto_s!=0)?($netto_s / $netto ) * 100:0; 
                    $persennet= number_format($perpnet,"2",",",".");                   
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$netto_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persennet</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
 //   <thead>                       
//                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
//                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
//                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
//                     </thead>
//                     <tfoot>
//                        <tr>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>                           
//                         </tr>
//                     </tfoot>
//    
    function _mpdf($judul='',$isi='',$lMargin=10,$rMargin=10,$font=10,$orientasi='') {
        
        ini_set("memory_limit","512M");
        $this->load->library('mpdf');
        
        /*
        $this->mpdf->progbar_altHTML = '<html><body>
	                                    <div style="margin-top: 5em; text-align: center; font-family: Verdana; font-size: 12px;"><img style="vertical-align: middle" src="'.base_url().'images/loading.gif" /> Creating PDF file. Please wait...</div>';        
        $this->mpdf->StartProgressBarOutput();
        */
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
        
        //$this->mpdf->SetHeader('SIMAKDA||');
        $jam = date("H:i:s");
        //$this->mpdf->SetFooter('Printed on @ {DATE j-m-Y H:i:s} |Simakda| Page {PAGENO} of {nb}');
        $this->mpdf->SetFooter('Printed on @ {DATE j-m-Y H:i:s} |Halaman {PAGENO} / {nb}| ');
        
        $this->mpdf->AddPage($orientasi);
        
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }
    
     function cari0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0',$lccr); 
	}
    function caridpa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0',$lccr); 
	}
    function caridppa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0',$lccr); 
	}
     function caridppa0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd',$lccr); 
	}
    function cari1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1',$lccr); 
	}
    function caridpa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1',$lccr); 
	}
    function caridppa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1',$lccr); 
	}
    function caridppa1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd',$lccr); 
	}
    function cari21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21',$lccr); 
	}
    function caridpa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21',$lccr); 
	}    
    function caridppa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21',$lccr); 
	}
    function caridppa21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd',$lccr); 
	}
    function caridppa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22',$lccr); 
	}
    function caridppa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221',$lccr); 
	}
    function cari0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd',$lccr); 
	}
    function cari1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd',$lccr); 
	}
    function cari21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd',$lccr); 
	}
    function cari22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 22','rka22',$lccr); 
	}
    function caridpa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22',$lccr); 
	}
    function cari221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function caridpa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function cari31()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31',$lccr); 
	}
    function cari31pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31',$lccr); 
	}
    function cari32()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32',$lccr); 
	}
    function cari32pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32',$lccr); 
	}
    function cari_perda1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN I','perda_1',$lccr); 
	}
    function cari_perdaIII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN III','perda_III',$lccr); 
	}
    function cari_perkadaII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_II',$lccr); 
	}
    
    function cari_perkada_ubah()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah',$lccr); 
	}
    
    function cari_perda1_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda1_ubah',$lccr); 
	}
    
    function cari_perdaIII_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah',$lccr); 
	}
    
    
function tambah_rka()
	{
		 $jk=$this->rka_model->combo_skpd();
         $ry=$this->rka_model->combo_giat();
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                   <tr >
                        <td >Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  ";
         
         $cRet .="<tr>
                        <td>Kode Kegiatan</td>
                        <td>:</td>
                        <td>$ry</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka',$data) ; 
   }

   
  	function tambah_rka_ubah()
	{
		 $jk=$this->rka_model->combo_skpd();
         $ry=$this->rka_model->combo_giat();
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                   <tr >
                        <td >Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  ";         
         $cRet .="<tr>
                        <td>Kode Kegiatan</td>
                        <td>:</td>
                        <td>$ry</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN PERUBAHAN';
        $this->template->set('title', 'INPUT RKA PERUBAHAN');   
        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                        'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'nilai_ubah' => $resulte['nilai_ubah']                          
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka_ubah',$data) ; 
   }


   function select_rka($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'])                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


   function select_rka_ubah($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'])                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

	   
   function select_rincian() {
        $sql = "select uraian,volume1 from trdpo ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'uraian' => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function ld_rek($giat='') {
    
        $sql = " SELECT kd_rek5,nm_rek5 FROM ms_rek5 where kd_rek5 not in (select kd_rek5 from trdrka where kd_kegiatan='$giat' ) and
		(kd_rek5 like '4%' or kd_rek5 like '5%' or kd_rek5 like '6%') order by kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
       
    function tsimpan($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0) {
       
		if (trim($reklama)==''){
			$reklama=$rekbaru;
		}

		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
		$query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai) ");	
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	

		$this->select_rka($kegiatan);
    }

    function tsimpan_ubah($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$nilai_ubah=0) {
       
		if (trim($reklama)==''){
			$reklama=$rekbaru;
		}

		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
		$query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai_ubah) ");
		$query = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	

		$this->select_rka_ubah($kegiatan);
    }

    function thapus($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka($kegiatan);
    }

    function thapus_ubah($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total_ubah=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka_ubah($kegiatan);
    }

    function thapus_rinci($skpd='',$kegiatan='',$rek,$index=0) {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rek);
    }
	
    function thapus_rinci_ubah($skpd='',$kegiatan='',$rek,$index=0) {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rek);
    }


	function rka_rinci($skpd='',$kegiatan='',$rekening='') {
        $norka = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],  
                        'uraian' => $resulte['uraian'],  
                        'volume1' => number_format($resulte['volume1']),  
                        'satuan1' => $resulte['satuan1'],  
                        'harga1' => number_format($resulte['harga1']),                             
                        'total' => number_format($resulte['total'])                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function rka_rinci_ubah($skpd='',$kegiatan='',$rekening='') {
        $norka = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],  
                        'uraian' => $resulte['uraian'],  
                        'volume1' => number_format($resulte['volume1']),  
                        'satuan1' => $resulte['satuan1'],  
                        'harga1' => number_format($resulte['harga1']),                             
                        'total' => number_format($resulte['total']),                             
                        'volume_ubah1' => number_format($resulte['volume_ubah1']),  
                        'satuan_ubah1' => $resulte['satuan_ubah1'],  
                        'harga_ubah1' => number_format($resulte['harga_ubah1']),                             
                        'total_ubah' => number_format($resulte['total_ubah'])                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	 
	 
	 function tsimpan_rinci($skpd='',$kegiatan='',$rekening='',$index=0,$uraian='',$volume=0,$satuan='',$harga=0){

		$satuan = str_replace("12345678987654321","",$satuan);
		$satuan = str_replace("undefined","",$satuan);

		$uraian = str_replace("%20"," ",$uraian);

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
		$total  = $volume*$harga;
		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah) values('$index','$norka','$uraian',$volume,'$satuan',$harga,$total,$volume,'$satuan',$harga,$total) ");  
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
	}

	 function tsimpan_rinci_ubah($skpd='',$kegiatan='',$rekening='',$index=0,$uraian='',$volume=0,$satuan='',$harga=0,$volume_ubah=0,$satuan_ubah='',$harga_ubah=0){

		$satuan = str_replace("12345678987654321","",$satuan);
		$satuan = str_replace("undefined","",$satuan);

		$satuan_ubah = str_replace("12345678987654321","",$satuan_ubah);
		$satuan_ubah = str_replace("undefined","",$satuan_ubah);
		$uraian = str_replace("%20"," ",$uraian);

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
		$total  = $volume*$harga;
		$total_ubah  = $volume_ubah*$harga_ubah;
		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah) values('$index','$norka','$uraian',$volume,'$satuan',$harga,$total,$volume_ubah,'$satuan_ubah',$harga_ubah,$total_ubah) ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah=(select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rekening);
	}


	function rka_hukum($skpd='',$kegiatan='') {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum WHERE kd_skpd='$skpd' AND kd_kegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
    
    function urusan() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_urusan,nm_urusan FROM ms_urusan where upper(kd_urusan) like upper('%$lccr%') or upper(nm_urusan) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_urusan' => $resulte['kd_urusan'],  
                        'nm_urusan' => $resulte['nm_urusan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    function skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function giat($cskpd='') {
        
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)=left('$cskpd',4) or left(kd_kegiatan,4)='0.00')";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function kegiatan($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$cskpd',4) or left(kd_kegiatan,4)='0.00') and 
        (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function tambah_giat()
	{
		$wy=$this->rka_model->combo_urus();
        $jk=$this->rka_model->combo_skpd1();         
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode Urusan</td>
                        <td>:</td>
                        <td>$wy</td>
                        </tr>
                  ";
         
         $cRet .="<tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;
        $data['page_title']= 'PILIH KEGIATAN';
        $this->template->set('title', 'DETAIL KEGIATAN');          
        $this->template->load('template','anggaran/rka/pilih_giat',$data) ; 
        //$this->load->view('anggaran/rka/tambah_rka',$data) ;
   }
   
   function select_giat($skpd='') {    
        $sql = "select a.kd_kegiatan1 as kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan from trskpd a inner join m_giat b on b.kd_kegiatan=a.kd_kegiatan1 where a.kd_skpd='$skpd' order by a.kd_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],                         
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'jns_kegiatan' => $resulte['jns_kegiatan']                           
                        );
                        $ii++;
        }
        echo json_encode($result);
    }
    
    function ld_giat($skpd='',$urusan='') {  
      
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$skpd',4) or left(kd_kegiatan,4)= '$urusan' or left(kd_kegiatan,4)='0.00') order by kd_kegiatan ";
        //$sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ld_jns() {    
        $sql = "SELECT jns_kegiatan FROM m_giat group by jns_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'jns_kegiatan' => $resulte['jns_kegiatan']                                               
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function psimpan($skpd='',$urusan='',$rekbaru='',$reklama='',$jns='') {        
    $kd=$this->right($rekbaru,5);	
	//$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
    $giat=$urusan.'.'.$skpd.'.'.$kd;
    $prog1=$this->left($giat,18);
    $prog=$this->left($rekbaru,13);
    $gabung=$skpd.'.'.$giat;
	$query = $this->db->query("delete from trskpd where kd_skpd='$skpd' and kd_kegiatan1='$reklama'");
	$query = $this->db->query("insert into trskpd(kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,kd_kegiatan1,kd_program1,jns_kegiatan) values('$gabung','$giat','$prog1','$urusan','$skpd','$rekbaru','$prog','$jns')");	

		
    $this->select_giat($skpd);
    }
    
    function ghapus($skpd='',$kegiatan) {
    	
		$query = $this->db->query(" delete from trskpd where kd_skpd='$skpd' and kd_kegiatan1='$kegiatan'");
		$this->select_giat($skpd);
    }
    
    
    function anggaran_kas()
	{
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS');   
        $this->template->load('template','anggaran/rka/anggaran_kas',$data) ; 
   }
       
   function load_trdskpd(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => $resulte['nilai']                                                                     
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
    function load_trskpd($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'total'       => $resulte['total']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function simpan_trskpd(){
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg > 0){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','1','$bln1','$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','2','$bln2','$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','3','$bln3','$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','4','$bln4','$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','5','$bln5','$status') ";
                $asg = $this->db->query($sql5);        
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','6','$bln6','$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','7','$bln7','$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','8','$bln8','$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','9','$bln9','$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','10','$bln10','$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','11','$bln11','$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','12','$bln12','$status') ";
                $asg = $this->db->query($sql12);         
                $sql13 = "update trskpd set triw1='$tr1',triw2='$tr2',triw3='$tr3',triw4='$tr4' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
        } else {
            echo '0';
            exit();
        }
        echo '1';
    }


}


